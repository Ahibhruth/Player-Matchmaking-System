<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Matchmaking Arena</title>
  <link rel="stylesheet" href="style.css">
</head>
<body style="overflow-y: auto;">
  <div class="game-ui">
    <div class="welcome-screen">
      <h1>üïπÔ∏è Welcome to the Matchmaking Arena</h1>
      <button onclick="startGame()">Start Game</button>
    </div>

    <div id="game-panel" class="game-panel" style="display:none;">
      <h2>Register Player</h2>
      <input type="text" id="regId" placeholder="Player ID">
      <input type="text" id="regName" placeholder="Player Name">
      <input type="number" id="regRank" placeholder="Rank">
      <select id="regStyle">
        <option value="aggressive">Aggressive</option>
        <option value="defensive">Defensive</option>
        <option value="balanced">Balanced</option>
      </select>
      <select id="regAvailable">
        <option value="true">Available</option>
        <option value="false">Not Available</option>
      </select>
      <input type="text" id="regAvoid" placeholder="Avoid playstyles (comma separated)">
      <button onclick="registerPlayer()">Register</button>
      <button onclick="printPlayersList()">Print Players List</button>

      <h2>Find Match</h2>
      <select id="matchDropdown">
        <!-- Player names will be populated here -->
      </select>
      <button onclick="findMatch()">Find Match</button>
      <button onclick="matchAgain()">Match Again</button>

      <h2>Delete Player</h2>
      <input type="text" id="deleteName" placeholder="Player name to delete">
      <button onclick="deletePlayer()">Delete</button>

      <div id="result"></div>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
// Populate player dropdown for matchmaking
function populatePlayerDropdown() {
  fetch("http://127.0.0.1:5000/api/players")
    .then((response) => response.json())
    .then((data) => {
      const dropdown = document.getElementById("matchDropdown");
      dropdown.innerHTML = "";
      data.players.forEach((name) => {
        const option = document.createElement("option");
        option.value = name;
        option.textContent = name;
        dropdown.appendChild(option);
      });
    });
}
// Call on page load and after registration
window.onload = populatePlayerDropdown;

let lastMatchedPlayers = [];
let lastSelectedPlayer = null;

// Update findMatch to use dropdown
function findMatch() {
  let name = document.getElementById("matchDropdown").value;
  if (name) {
    lastSelectedPlayer = name;
    lastMatchedPlayers = [];
    fetch(`http://127.0.0.1:5000/api/match/${name}`)
      .then((response) => response.json())
      .then((data) => {
        if (data.matches) {
          lastMatchedPlayers = [data.matches[0]];
          document.getElementById("result").innerHTML =
            "<h3>Matched Player: </h3>" + data.matches.join(", ");
        } else {
          lastMatchedPlayers = [];
          document.getElementById("result").innerHTML =
            "<h3>" + data.error + "</h3>";
        }
      });
  } else {
    alert("Please select a player!");
  }
}

function matchAgain() {
  if (!lastSelectedPlayer || lastMatchedPlayers.length === 0) {
    alert("Please find a match first.");
    return;
  }
  // Exclude all previously matched players
  const excludeParams = lastMatchedPlayers.map(p => `exclude=${encodeURIComponent(p)}`).join('&');
  fetch(`http://127.0.0.1:5000/api/match/${lastSelectedPlayer}?${excludeParams}`)
    .then((response) => response.json())
    .then((data) => {
      if (data.matches) {
        lastMatchedPlayers.push(data.matches[0]);
        document.getElementById("result").innerHTML =
          "<h3>Matched Player: </h3>" + data.matches.join(", ");
      } else {
        document.getElementById("result").innerHTML =
          "<h3>" + data.error + "</h3>";
      }
    });
}

// After registering a player, refresh the dropdown
function registerPlayer() {
  let id = document.getElementById("regId").value;
  let name = document.getElementById("regName").value;
  let rank = document.getElementById("regRank").value;
  let playstyle = document.getElementById("regStyle").value;
  let available = document.getElementById("regAvailable").value === "true";
  let avoid = document.getElementById("regAvoid").value.split(",").map(s => s.trim()).filter(Boolean);
  if (id && name && rank) {
    fetch("http://127.0.0.1:5000/api/register_player", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        id: parseInt(id),
        name: name,
        rank: parseInt(rank),
        playstyle: playstyle,
        available: available,
        avoid: avoid
      }),
    })
      .then((response) => response.json())
      .then((data) => {
        alert(data.message);
        if (data.message === "Player registered successfully!") {
          document.getElementById("regId").value = "";
          document.getElementById("regName").value = "";
          document.getElementById("regRank").value = "";
          document.getElementById("regAvoid").value = "";
          populatePlayerDropdown();
        }
      });
  } else {
    alert("Please fill in all fields!");
  }
}

function printPlayersList() {
  fetch("http://127.0.0.1:5000/api/players")
    .then((response) => response.json())
    .then((data) => {
      alert("Players: " + data.players.join(", "));
    });
}
// ...existing code...
</script>
</body>
</html>
